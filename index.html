<!DOCTYPE html>
<html>

	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta charset="utf-8" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/animate.css" rel="stylesheet" />
		<link rel="stylesheet" href="font-awesome-4.6.3/css/font-awesome.min.css">
		<style type="text/css">
			html,
			#body {
				max-width: 750px;
			}
			
			html,
			body,
			#body {
				width: 100%;
				min-height: 100%;
				margin: 0 auto;
				font-family: Helvetica Neue, Helvetica, Hiragino Sans GB, Microsoft YaHei, Arial, sans-serif;
			}
			
			img {
				max-width: 100%;
			}
			
			.detail {
				width: 95%;
				margin: 2.5%;
				padding: 2.5%;
				line-height: 1.5625rem;
				display: inline-block;
			}
			
			#useravatar1 {
				width: 3rem;
				height: 3rem;
				border-radius: 50%;
				border: 2px solid #fff;
			}
			
			.cover {
				background: RGBA(255, 255, 255, 0.6);
				height: 100%;
				z-index: -1;
				border-radius: 10px;
				margin-top: 4rem !important;
			}
			
			.bg {
				width: 100%;
				position: relative;
				z-index: 1;
				min-height: 100%;
			}
			
			.fa-music {
				padding: 0.35rem;
				background: #fff;
				border-radius: 50px;
				color: #333;
				box-shadow: 0px 0px 1px #333;
				width: 1.5rem;
				height: 1.5rem;
				box-shadow: 0px 0.05px 0.05px #333;
			}
			
			.fa-music[play=stop] {
				animation: rotate 4s linear infinite;
				-webkit-animation: rotate 4s linear infinite;
				-ms-animation: rotate 4s linear infinite;
				-moz-animation: rotate 4s linear infinite;
				-o-animation: rotate 4s linear infinite;
			}
			/**通用样式**/
			
			.music {
				width: 100%;
				height: 42px;
				border-radius: 5px;
				margin: 10px 8px 0 0;
				background: #f6f6f6;
				padding: 0;
				line-height: 42px;
				cursor: pointer;
			}
			
			.music[play=on] i {
				background-image: url("img/on.png");
			}
			
			.music[play=stop] i {
				background-image: url("img/off.png");
			}
			
			.music i {
				float: left;
				width: 25px;
				height: 25px;
				background-size: contain;
				background-repeat: no-repeat;
				background-position: center;
				margin: 8px 10px 0 15px;
			}
			
			.music span {
				width: calc(100% - 70px);
				width: -webkit-calc(100% - 70px);
				margin: 0;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				float: left;
				text-align: left;
			}
			/*模板选择*/
			
			#temps {
				background: #eee;
				height: 100px;
				position: fixed;
				bottom: 0px;
				top: auto;
				z-index: 99999;
				border: 0px;
			}
			
			.temp {
				width: 80px !important;
				height: 80px !important;
				padding: 0px !important;
				position: relative;
				margin-left: 8px !important;
			}
			
			.temp:first-child {
				margin-left: 10px !important;
			}
			
			.temp:last-child {
				margin-right: 10px !important;
			}
			
			.temp img {
				width: 100% !important;
				height: 100% !important;
			}
			
			.temp.hover img {
				border: 2px solid #ed5565;
			}
		</style>
	</head>

	<body>
		<div class="mui-content mui-scroll-wrapper">
			<div class="mui-scroll bg" id="bg">
				<!--通用样式-->
				<div id="main0" class="hide">
					<div class="f13 tl detail">
						<div class="full tl">
							<p class="f20 c000" id="title0"></p>
							<span class="mt0 mb0 csubtitle f13" id="createdate0"></span>
							<span class="mb0 blue ml10 user mt10" userid="0" id="nickname0"></span>
							<span class="mt0 mb0 ml10 csubtitle f13" id="views0"></span>
							<p id="music0" play="on" class="music" onclick="switchsound()">
								<i></i>
								<span id="musicname0"></span>
							</p>
						</div>
						<div class="c000 full mt20 mb20" id="desc0">
						</div>
					</div>
				</div>
				<!--排版1-->
				<div id="main1" class="hide">
					<div class="tc" style="width: 95%; margin: 0px 2.5%; padding-top: 2.5%;">
						<div class="full" style="position: relative;">
							<img id="useravatar1" />
							<p class="full mb0 user blue mt10" userid="0" id="nickname1"></p>
							<i id="music1" class="fa fa-music f13" onclick="switchsound()" style="position: absolute; right: 0px; top: 0px;"></i>
						</div>
					</div>
					<div class="f13 tl detail cover">
						<div class="full tc">
							<p class="mt10 mb0 f20 c000" id="title1"></p>
							<p class="mt0 mb10 full csubtitle f13 tc">
								<span id="createdate1"></span>
								<span class="ml10" id="views1"></span>
							</p>
						</div>
						<div class="c000 full mb20" id="desc1">
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>

</html>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/music.js"></script>
<script src="js/mui.min.js"></script>
<script type="text/javascript" src="http://player.youku.com/jsapi"></script>
<script type="text/javascript">
	var MusicID = 0;
	var MusicUrl = "";

	$(function() {

		var deceleration = mui.os.ios ? 0.003 : 0.0009; // 阻尼系数
		mui('.mui-scroll-wrapper').scroll({
			bounce: false,
			indicators: false, // 是否显示滚动条
			deceleration: deceleration
		});

		var key = GetParameter("key");
		mui.getJSON("http://139.224.51.196/Home/Info", {
			key: key
		}, function(data) {
			if(!data.result) {
				return mui.toast(data.message);
			}
			data = data.message;
			//段落
			var html = [];
			var parts = data.ArticlePart;
			for(var i = 0; i < parts.length; i++) {
				var part = parts[i];
				if(part.Types == 1) {
					//图片
					html.push('<div class="full f13 mt10"><img src="' + part.Introduction + '" class="full" /></div>');
				} else if(part.Types == 2) {
					//文本
					html.push('<div class="full f13 mt10">' + part.Introduction + '</div>');
				} else if(part.Types == 3) {
					//视频
					html.push('<div class="full f13 mt10">' + AppendVideo(part.Introduction) + '</div>');
				}
			}

			if(!IsNullOrEmpty(data.Cover)) {
				$("#bg").css({
					"background": "url(" + data.Cover + ") no-repeat",
					"background-size": "100% auto"
				});
			}

			$("#footer_zan").html(data.Goods);
			$("#footer_comment").html(data.Comments);

			//排版
			var mainIndex = 1;
			$("#title" + mainIndex).html(data.Title);
			$("#nickname" + mainIndex).html(data.NickName);
			$("#createdate" + mainIndex).html(data.CreateDateText);
			$("#views" + mainIndex).html("阅读  " + data.Views);
			$("#desc" + mainIndex).html(html.join(""));

			//实例化播放器
			$(".youku_player").each(function() {
				var $this = $(this);
				ShowVideo($this.attr("id"), $this.attr("sid"));
			});

			//音乐
			MusicID = "music" + mainIndex;
			MusicUrl = data.MusicUrl;
			if(!IsNullOrEmpty(MusicUrl)) {
				if(data.AutoMusic == "1") {
					document.addEventListener('touchstart', startsound);
				}
				$("#music" + mainIndex).removeClass("hide");
			} else {
				$("#music" + mainIndex).addClass("hide");
			}

			switch(mainIndex) {
				case 0:
					$("#musicname0").html(data.MusicName);
					break;
				case 1:
					$("#useravatar1").attr("src", data.Avatar);
					$("#main1").removeClass("hide");
					break;
				default:
					break;
			}
		});
	});

	function ShowVideo(domid, vid) {
		player = new YKU.Player(domid, {
			client_id: base.youku_client_id,
			styleid: '0',
			vid: vid,
			autoplay: false,
			show_related: false
		});
	}

	function AppendVideo(sourceurl) {
		var html = [];
		//优酷
		if(sourceurl.indexOf(".") < 0) {
			return '<div class="media-cont audio-cont" style="margin-top: 10px; width: 100%;"><div id="youku_player_' + sourceurl + '" sid="' + sourceurl + '" class="youku_player" style="width:100%;height:400px;"></div></div>';
		}
		//SWF
		if(sourceurl.toLowerCase().indexOf(".swf") > 0) {
			return '<div class="media-cont audio-cont" style="margin-top:10px;width: 100%;"><embed src="' + sourceurl + '" allowfullscreen="true" quality="high" width="100%"  height="400" align="middle" allowscriptaccess="always" type="application/x-shockwave-flash"></embed></div>';
		}
		return "";
	}

	function IsNullOrEmpty(str) {
		if(str == null || str == undefined || str == "") {
			return true;
		}
		return false;
	}

	/*获取html的参数**********************************************/
	function GetParameter(param) {
		var query = window.location.search;
		query = doFilter(query);
		var iLen = param.length;
		var iStart = query.indexOf(param);
		if(iStart == -1) {
			return "";
		}
		iStart += iLen + 1;
		var iEnd = query.indexOf("&", iStart);
		if(iEnd == -1) {
			return query.substring(iStart);
		}
		return query.substring(iStart, iEnd);
	};

	//过滤多余问号的情况
	function doFilter(query) {
		//出现多个？的情况，保留第一个，其他都改为&
		var queryParam = query.split('?');
		if(queryParam.length > 1) {
			var _index = query.indexOf("?") + 1;
			var queryBefore = query.substr(0, _index);
			var queryAfter = query.substr(_index);
			queryAfter = queryAfter.replace("?", "&");
			//替换除第一？外的情况
			query = queryBefore + queryAfter;
		}
		return query;
	};
</script>